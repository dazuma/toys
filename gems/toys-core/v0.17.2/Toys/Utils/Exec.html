<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Toys::Utils::Exec
  
    &mdash; Toys
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Toys::Utils::Exec";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (E)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Toys.html" title="Toys (module)">Toys</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Utils.html" title="Toys::Utils (module)">Utils</a></span></span>
     &raquo; 
    <span class="title">Exec</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Toys::Utils::Exec
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Toys::Utils::Exec</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/toys/utils/exec.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>A service that executes subprocesses.</p>

<p>This service provides a convenient interface for controlling spawned
processes and their streams. It also provides shortcuts for common cases
such as invoking Ruby in a subprocess or capturing output in a string.</p>

<p>This class is not loaded by default. Before using it directly, you should
<code>require &quot;toys/utils/exec&quot;</code></p>

<h3 id="the-exec-service">The exec service</h3>

<p>The main entrypoint class is this one, <span class='object_link'><a href="" title="Toys::Utils::Exec (class)">Exec</a></span>. It&#39;s a
&quot;service&quot; object that provides functionality, primarily methods that
spawn processes. Create it like any object:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>toys/utils/exec</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_exec_service'>exec_service</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../../Toys.html" title="Toys (module)">Toys</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Utils.html" title="Toys::Utils (module)">Utils</a></span></span><span class='op'>::</span><span class='const'>Exec</span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="Toys::Utils::Exec#initialize (method)">new</a></span></span>
</code></pre>

<p>There are two &quot;primitive&quot; functions: <span class='object_link'><a href="#exec-instance_method" title="Toys::Utils::Exec#exec (method)">#exec</a></span> and <span class='object_link'><a href="#exec_proc-instance_method" title="Toys::Utils::Exec#exec_proc (method)">#exec_proc</a></span>. The <span class='object_link'><a href="#exec-instance_method" title="Toys::Utils::Exec#exec (method)">#exec</a></span>
method spawns an operating system process specified by an executable and
a set of arguments. The <span class='object_link'><a href="#exec_proc-instance_method" title="Toys::Utils::Exec#exec_proc (method)">#exec_proc</a></span> method takes a <code>Proc</code> and forks a
Ruby process. Both of these can be heavily configured with stream
handling, result handling, and numerous other options described below.
The class also provides convenience methods for common cases such as
spawning a Ruby process, spawning a shell script, or capturing output.</p>

<p>The exec service class also stores default configuration that it applies
to processes it spawns. You can set these defaults when constructing the
service class, or at any time by calling <span class='object_link'><a href="#configure_defaults-instance_method" title="Toys::Utils::Exec#configure_defaults (method)">#configure_defaults</a></span>.</p>

<h3 id="controlling-processes">Controlling processes</h3>

<p>A process can be started in the <em>foreground</em> or the <em>background</em>. If you
start a foreground process, it will &quot;take over&quot; your standard input and
output streams by default, and it will keep control until it completes.
If you start a background process, its streams will be redirected to null
by default, and control will be returned to you immediately.</p>

<p>While a process is running, you can control it using a
<span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Controller</a></span> object. Use a controller to interact with
the process&#39;s input and output streams, send it signals, or wait for it
to complete.</p>

<p>When running a process in the foreground, the controller will be yielded
to an optional block. For example, the following code starts a process in
the foreground and passes its output stream to a controller.</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_exec_service'>exec_service</span><span class='period'>.</span><span class='id identifier rubyid_exec'>exec</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>git</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>init</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>out:</span> <span class='symbol'>:controller</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_controller'>controller</span><span class='op'>|</span>
  <span class='id identifier rubyid_loop'>loop</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_line'>line</span> <span class='op'>=</span> <span class='id identifier rubyid_controller'>controller</span><span class='period'>.</span><span class='id identifier rubyid_out'>out</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span>
    <span class='kw'>break</span> <span class='kw'>if</span> <span class='id identifier rubyid_line'>line</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Got line: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_line'>line</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>When running a process in the background, the controller is returned from
the method that starts the process:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_controller'>controller</span> <span class='op'>=</span> <span class='id identifier rubyid_exec_service'>exec_service</span><span class='period'>.</span><span class='id identifier rubyid_exec'>exec</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>git</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>init</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>background:</span> <span class='kw'>true</span><span class='rparen'>)</span>
</code></pre>

<h3 id="stream-handling">Stream handling</h3>

<p>By default, subprocess streams are connected to the corresponding streams
in the parent process. You can change this behavior, redirecting streams
or providing ways to control them, using the <code>:in</code>, <code>:out</code>, and <code>:err</code>
options.</p>

<p>Three general strategies are available for custom stream handling. First,
you can redirect to other streams such as files, IO objects, or Ruby
strings. Some of these options map directly to options provided by the
<code>Process#spawn</code> method. Second, you can use a controller to manipulate
the streams programmatically. Third, you can capture output stream data
and make it available in the result.</p>

<p>Following is a full list of the stream handling options, along with how
to specify them using the <code>:in</code>, <code>:out</code>, and <code>:err</code> options.</p>

<ul>
<li><p><strong>Inherit parent stream:</strong> You can inherit the corresponding stream
in the parent process by passing <code>:inherit</code> as the option value. This
is the default if the subprocess is <em>not</em> run in the background.</p></li>
<li><p><strong>Redirect to null:</strong> You can redirect to a null stream by passing
<code>:null</code> as the option value. This connects to a stream that is not
closed but contains no data, i.e. <code>/dev/null</code> on unix systems. This
is the default if the subprocess is run in the background.</p></li>
<li><p><strong>Close the stream:</strong> You can close the stream by passing <code>:close</code> as
the option value. This is the same as passing <code>:close</code> to
<code>Process#spawn</code>.</p></li>
<li><p><strong>Redirect to a file:</strong> You can redirect to a file. This reads from
an existing file when connected to <code>:in</code>, and creates or appends to a
file when connected to <code>:out</code> or <code>:err</code>. To specify a file, use the
setting <code>[:file, &quot;/path/to/file&quot;]</code>. You can also, when writing a
file, append an optional mode and permission code to the array. For
example, <code>[:file, &quot;/path/to/file&quot;, &quot;a&quot;, 0644]</code>.</p></li>
<li><p><strong>Redirect to an IO object:</strong> You can redirect to an IO object in the
parent process, by passing the IO object as the option value. You can
use any IO object. For example, you could connect the child&#39;s output
to the parent&#39;s error using <code>out: $stderr</code>, or you could connect to
an existing File stream. Unlike <code>Process#spawn</code>, this works for IO
objects that do not have a corresponding file descriptor (such as
StringIO objects). In such a case, a thread will be spawned to pipe
the IO data through to the child process.</p></li>
<li><p><strong>Redirect to a pipe:</strong> You can redirect to a pipe created using
<code>IO.pipe</code> (i.e. a two-element array of read and write IO objects) by
passing the array as the option value. This will connect the
appropriate IO (either read or write), and close it in the parent.
Thus, you can connect only one process to each end. If you want more
direct control over IO closing behavior, pass the IO object (i.e. the
element of the pipe array) directly.</p></li>
<li><p><strong>Combine with another child stream:</strong> You can redirect one child
output stream to another, to combine them. To merge the child&#39;s error
stream into its output stream, use <code>err: [:child, :out]</code>.</p></li>
<li><p><strong>Read from a string:</strong> You can pass a string to the input stream by
setting <code>[:string, &quot;the string&quot;]</code>. This works only for <code>:in</code>.</p></li>
<li><p><strong>Capture output stream:</strong> You can capture a stream and make it
available on the <span class='object_link'><a href="Exec/Result.html" title="Toys::Utils::Exec::Result (class)">Result</a></span> object, using the
setting <code>:capture</code>. This works only for the <code>:out</code> and <code>:err</code>
streams.</p></li>
<li><p><strong>Use the controller:</strong> You can hook a stream to the controller using
the setting <code>:controller</code>. You can then manipulate the stream via the
controller. If you pass a block to <span class='object_link'><a href="#exec-instance_method" title="Toys::Utils::Exec#exec (method)">#exec</a></span>, it
yields the <span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Controller</a></span>, giving you access to
streams.</p></li>
<li><p><strong>Make copies of an output stream:</strong> You can &quot;tee,&quot; or duplicate the
<code>:out</code> or <code>:err</code> stream and redirect those copies to various
destinations. To specify a tee, use the setting <code>[:tee, ...]</code> where
the additional array elements include two or more of the following.
See the corresponding documentation above for more detail.</p>

<ul>
<li> <code>:inherit</code> to direct to the parent process&#39;s stream.</li>
<li> <code>:capture</code> to capture the stream and store it in the result.</li>
<li> <code>:controller</code> to direct the stream to the controller.</li>
<li> <code>[:file, &quot;/path/to/file&quot;]</code> to write to a file.</li>
<li> An <code>IO</code> or <code>StringIO</code> object.</li>
<li> An array of two <code>IO</code> objects representing a pipe</li>
</ul>

<p>Additionally, the last element of the array can be a hash of options.
Supported options include:</p>

<ul>
<li> <code>:buffer_size</code> The size of the memory buffer for each element of
the tee. Larger buffers may allow higher throughput. The default
is 65536.</li>
</ul></li>
</ul>

<h3 id="result-handling">Result handling</h3>

<p>A subprocess result is represented by a <span class='object_link'><a href="Exec/Result.html" title="Toys::Utils::Exec::Result (class)">Result</a></span>
object, which includes the exit code, the content of any captured output
streams, and any exeption raised when attempting to run the process.
When you run a process in the foreground, the method will return a result
object. When you run a process in the background, you can obtain the
result from the controller once the process completes.</p>

<p>The following example demonstrates running a process in the foreground
and getting the exit code:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_exec_service'>exec_service</span><span class='period'>.</span><span class='id identifier rubyid_exec'>exec</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>git</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>init</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>exit code: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_exit_code'>exit_code</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
</code></pre>

<p>The following example demonstrates starting a process in the background,
waiting for it to complete, and getting its exit code:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_controller'>controller</span> <span class='op'>=</span> <span class='id identifier rubyid_exec_service'>exec_service</span><span class='period'>.</span><span class='id identifier rubyid_exec'>exec</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>git</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>init</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>background:</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='id identifier rubyid_controller'>controller</span><span class='period'>.</span><span class='id identifier rubyid_result'>result</span><span class='lparen'>(</span><span class='label'>timeout:</span> <span class='float'>1.0</span><span class='rparen'>)</span>
<span class='kw'>if</span> <span class='id identifier rubyid_result'>result</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>exit code: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_exit_code'>exit_code</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>else</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>timed out</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
</code></pre>

<p>You can also provide a callback that is executed once a process
completes. For example:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_my_callback'>my_callback</span> <span class='op'>=</span> <span class='id identifier rubyid_proc'>proc</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_result'>result</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>exit code: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_exit_code'>exit_code</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span>
<span class='id identifier rubyid_exec_service'>exec_service</span><span class='period'>.</span><span class='id identifier rubyid_exec'>exec</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>git</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>init</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='label'>result_callback:</span> <span class='id identifier rubyid_my_callback'>my_callback</span><span class='rparen'>)</span>
</code></pre>

<h3 id="configuration-options">Configuration options</h3>

<p>A variety of options can be used to control subprocesses. These can be
provided to any method that starts a subprocess. Youc an also set
defaults by calling <span class='object_link'><a href="#configure_defaults-instance_method" title="Toys::Utils::Exec#configure_defaults (method)">#configure_defaults</a></span>.</p>

<p>Options that affect the behavior of subprocesses:</p>

<ul>
<li><p><code>:env</code> (Hash) Environment variables to pass to the subprocess.
Keys represent variable names and should be strings. Values should be
either strings or <code>nil</code>, which unsets the variable.</p></li>
<li><p><code>:background</code> (Boolean) Runs the process in the background if <code>true</code>.</p></li>
<li><p><code>:result_callback</code> (Proc) Called and passed the result object when
the subprocess exits.</p></li>
</ul>

<p>Options for connecting input and output streams. See the section above on
stream handling for info on the values that can be passed.</p>

<ul>
<li><p><code>:in</code> Connects the input stream of the subprocess. See the section on
stream handling.</p></li>
<li><p><code>:out</code> Connects the standard output stream of the subprocess. See the
section on stream handling.</p></li>
<li><p><code>:err</code> Connects the standard error stream of the subprocess. See the
section on stream handling.</p></li>
</ul>

<p>Options related to logging and reporting:</p>

<ul>
<li><p><code>:logger</code> (Logger) Logger to use for logging the actual command. If
not present, the command is not logged.</p></li>
<li><p><code>:log_level</code> (Integer,false) Level for logging the actual command.
Defaults to Logger::INFO if not present. You can also pass <code>false</code> to
disable logging of the command.</p></li>
<li><p><code>:log_cmd</code> (String) The string logged for the actual command.
Defaults to the <code>inspect</code> representation of the command.</p></li>
<li><p><code>:name</code> (Object) An optional object that can be used to identify this
subprocess. It is available in the controller and result objects.</p></li>
</ul>

<p>In addition, the following options recognized by
<a href="https://ruby-doc.org/core/Process.html#method-c-spawn"><code>Process#spawn</code></a>
are supported.</p>

<ul>
<li><p><code>:chdir</code> (String) Set the working directory for the command.</p></li>
<li><p><code>:close_others</code> (Boolean) Whether to close non-redirected
non-standard file descriptors.</p></li>
<li><p><code>:new_pgroup</code> (Boolean) Create new process group (Windows only).</p></li>
<li><p><code>:pgroup</code> (Integer,true,nil) The process group setting.</p></li>
<li><p><code>:umask</code> (Integer) Umask setting for the new process.</p></li>
<li><p><code>:unsetenv_others</code> (Boolean) Clear environment variables except those
explicitly set.</p></li>
</ul>

<p>Any other option key will result in an <code>ArgumentError</code>.</p>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Controller</a></span>, <span class='object_link'><a href="Exec/Result.html" title="Toys::Utils::Exec::Result (class)">Result</a></span>
    
  
</p>







  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#capture-instance_method" title="#capture (instance method)">#<strong>capture</strong>(cmd, **opts) {|controller| ... } &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Execute a command.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#capture_proc-instance_method" title="#capture_proc (instance method)">#<strong>capture_proc</strong>(func, **opts) {|controller| ... } &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Execute a proc in a fork.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#capture_ruby-instance_method" title="#capture_ruby (instance method)">#<strong>capture_ruby</strong>(args, **opts) {|controller| ... } &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Spawn a ruby process and pass the given arguments to it.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#configure_defaults-instance_method" title="#configure_defaults (instance method)">#<strong>configure_defaults</strong>(**opts)  &#x21d2; self </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Set default options.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#exec-instance_method" title="#exec (instance method)">#<strong>exec</strong>(cmd, **opts) {|controller| ... } &#x21d2; Toys::Utils::Exec::Controller, Toys::Utils::Exec::Result </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Execute a command.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#exec_proc-instance_method" title="#exec_proc (instance method)">#<strong>exec_proc</strong>(func, **opts) {|controller| ... } &#x21d2; Toys::Utils::Exec::Controller, Toys::Utils::Exec::Result </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Execute a proc in a fork.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#exec_ruby-instance_method" title="#exec_ruby (instance method)">#<strong>exec_ruby</strong>(args, **opts) {|controller| ... } &#x21d2; Toys::Utils::Exec::Controller, Toys::Utils::Exec::Result </a>
    

    
      (also: #ruby)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Spawn a ruby process and pass the given arguments to it.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(**opts, &amp;block)  &#x21d2; Exec </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Create an exec service.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sh-instance_method" title="#sh (instance method)">#<strong>sh</strong>(cmd, **opts) {|controller| ... } &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Execute the given string in a shell.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(**opts, &amp;block)  &#x21d2; <tt><span class='object_link'><a href="" title="Toys::Utils::Exec (class)">Exec</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Create an exec service.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>block</span>
      
      
        <span class='type'>(<tt>Proc</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A block that is called if a key is not found. It is
passed the unknown key, and expected to return a default value
(which can be nil).</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>keywords</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Initial default options. See <span class='object_link'><a href="" title="Toys::Utils::Exec (class)">Toys::Utils::Exec</a></span>
for a description of the options.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


264
265
266
267
268
269</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/toys/utils/exec.rb', line 264</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rbconfig</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>logger</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>stringio</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@default_opts</span> <span class='op'>=</span> <span class='const'>Opts</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="capture-instance_method">
  
    #<strong>capture</strong>(cmd, **opts) {|controller| ... } &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Execute a command. The command can be given as a single string to pass
to a shell, or an array of strings indicating a posix command.</p>

<p>Captures standard out and returns it as a string.
Cannot be run in the background.</p>

<p>If a block is provided, a <span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Controller</a></span> will be
yielded to it.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>cmd</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The command to execute.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>keywords</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The command options. See the section on
configuration options in the <span class='object_link'><a href="" title="Toys::Utils::Exec (class)">Toys::Utils::Exec</a></span> class docs.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>controller</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Toys::Utils::Exec::Controller</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A controller
for the subprocess streams.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>What was written to standard out.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


384
385
386
387</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/toys/utils/exec.rb', line 384</span>

<span class='kw'>def</span> <span class='id identifier rubyid_capture'>capture</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>out:</span> <span class='symbol'>:capture</span><span class='comma'>,</span> <span class='label'>background:</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_exec'>exec</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_captured_out'>captured_out</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="capture_proc-instance_method">
  
    #<strong>capture_proc</strong>(func, **opts) {|controller| ... } &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Execute a proc in a fork.</p>

<p>Captures standard out and returns it as a string.
Cannot be run in the background.</p>

<p>If a block is provided, a <span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Controller</a></span> will be
yielded to it.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>func</span>
      
      
        <span class='type'>(<tt>Proc</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The proc to call.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>keywords</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The command options. See the section on
configuration options in the <span class='object_link'><a href="" title="Toys::Utils::Exec (class)">Toys::Utils::Exec</a></span> class docs.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>controller</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Toys::Utils::Exec::Controller</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A controller
for the subprocess streams.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>What was written to standard out.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


428
429
430
431</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/toys/utils/exec.rb', line 428</span>

<span class='kw'>def</span> <span class='id identifier rubyid_capture_proc'>capture_proc</span><span class='lparen'>(</span><span class='id identifier rubyid_func'>func</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>out:</span> <span class='symbol'>:capture</span><span class='comma'>,</span> <span class='label'>background:</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_exec_proc'>exec_proc</span><span class='lparen'>(</span><span class='id identifier rubyid_func'>func</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_captured_out'>captured_out</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="capture_ruby-instance_method">
  
    #<strong>capture_ruby</strong>(args, **opts) {|controller| ... } &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Spawn a ruby process and pass the given arguments to it.</p>

<p>Captures standard out and returns it as a string.
Cannot be run in the background.</p>

<p>If a block is provided, a <span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Controller</a></span> will be
yielded to it.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>args</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The arguments to ruby.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>keywords</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The command options. See the section on
configuration options in the <span class='object_link'><a href="" title="Toys::Utils::Exec (class)">Toys::Utils::Exec</a></span> class docs.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>controller</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Toys::Utils::Exec::Controller</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A controller
for the subprocess streams.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>What was written to standard out.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


406
407
408
409</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/toys/utils/exec.rb', line 406</span>

<span class='kw'>def</span> <span class='id identifier rubyid_capture_ruby'>capture_ruby</span><span class='lparen'>(</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>out:</span> <span class='symbol'>:capture</span><span class='comma'>,</span> <span class='label'>background:</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ruby'>ruby</span><span class='lparen'>(</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_captured_out'>captured_out</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="configure_defaults-instance_method">
  
    #<strong>configure_defaults</strong>(**opts)  &#x21d2; <tt>self</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Set default options. See <span class='object_link'><a href="" title="Toys::Utils::Exec (class)">Toys::Utils::Exec</a></span> for a description of the
options.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>keywords</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>New default options to set</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>self</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


278
279
280
281</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/toys/utils/exec.rb', line 278</span>

<span class='kw'>def</span> <span class='id identifier rubyid_configure_defaults'>configure_defaults</span><span class='lparen'>(</span><span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='ivar'>@default_opts</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='kw'>self</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="exec-instance_method">
  
    #<strong>exec</strong>(cmd, **opts) {|controller| ... } &#x21d2; <tt><span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Toys::Utils::Exec::Controller</a></span></tt>, <tt><span class='object_link'><a href="Exec/Result.html" title="Toys::Utils::Exec::Result (class)">Toys::Utils::Exec::Result</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Execute a command. The command can be given as a single string to pass
to a shell, or an array of strings indicating a posix command.</p>

<p>If the process is not set to run in the background, and a block is
provided, a <span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Controller</a></span> will be yielded to it.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>cmd</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The command to execute.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>keywords</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The command options. See the section on
configuration options in the <span class='object_link'><a href="" title="Toys::Utils::Exec (class)">Toys::Utils::Exec</a></span> class docs.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>controller</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Toys::Utils::Exec::Controller</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A controller
for the subprocess streams.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Toys::Utils::Exec::Controller</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The subprocess controller, if
the process is running in the background.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Exec/Result.html" title="Toys::Utils::Exec::Result (class)">Toys::Utils::Exec::Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The result, if the process ran in
the foreground.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/toys/utils/exec.rb', line 301</span>

<span class='kw'>def</span> <span class='id identifier rubyid_exec'>exec</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_exec_opts'>exec_opts</span> <span class='op'>=</span> <span class='const'>Opts</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@default_opts</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_spawn_cmd'>spawn_cmd</span> <span class='op'>=</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_cmd'>cmd</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='op'>::</span><span class='const'>Array</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_cmd'>cmd</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>1</span>
        <span class='id identifier rubyid_binary'>binary</span> <span class='op'>=</span> <span class='id identifier rubyid_canonical_binary_spec'>canonical_binary_spec</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='comma'>,</span> <span class='id identifier rubyid_exec_opts'>exec_opts</span><span class='rparen'>)</span>
        <span class='lbracket'>[</span><span class='id identifier rubyid_binary'>binary</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_cmd'>cmd</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:to_s</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='lbracket'>[</span><span class='id identifier rubyid_canonical_binary_spec'>canonical_binary_spec</span><span class='lparen'>(</span><span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='id identifier rubyid_exec_opts'>exec_opts</span><span class='rparen'>)</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='lbracket'>[</span><span class='id identifier rubyid_cmd'>cmd</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
  <span class='id identifier rubyid_executor'>executor</span> <span class='op'>=</span> <span class='const'>Executor</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_exec_opts'>exec_opts</span><span class='comma'>,</span> <span class='id identifier rubyid_spawn_cmd'>spawn_cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_executor'>executor</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="exec_proc-instance_method">
  
    #<strong>exec_proc</strong>(func, **opts) {|controller| ... } &#x21d2; <tt><span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Toys::Utils::Exec::Controller</a></span></tt>, <tt><span class='object_link'><a href="Exec/Result.html" title="Toys::Utils::Exec::Result (class)">Toys::Utils::Exec::Result</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Execute a proc in a fork.</p>

<p>If the process is not set to run in the background, and a block is
provided, a <span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Controller</a></span> will be yielded to it.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>func</span>
      
      
        <span class='type'>(<tt>Proc</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The proc to call.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>keywords</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The command options. See the section on
configuration options in the <span class='object_link'><a href="" title="Toys::Utils::Exec (class)">Toys::Utils::Exec</a></span> class docs.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>controller</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Toys::Utils::Exec::Controller</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A controller
for the subprocess streams.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Toys::Utils::Exec::Controller</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The subprocess controller, if
the process is running in the background.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Exec/Result.html" title="Toys::Utils::Exec::Result (class)">Toys::Utils::Exec::Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The result, if the process ran in
the foreground.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


360
361
362
363
364</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/toys/utils/exec.rb', line 360</span>

<span class='kw'>def</span> <span class='id identifier rubyid_exec_proc'>exec_proc</span><span class='lparen'>(</span><span class='id identifier rubyid_func'>func</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_exec_opts'>exec_opts</span> <span class='op'>=</span> <span class='const'>Opts</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='ivar'>@default_opts</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_executor'>executor</span> <span class='op'>=</span> <span class='const'>Executor</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_exec_opts'>exec_opts</span><span class='comma'>,</span> <span class='id identifier rubyid_func'>func</span><span class='comma'>,</span> <span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_executor'>executor</span><span class='period'>.</span><span class='id identifier rubyid_execute'>execute</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="exec_ruby-instance_method">
  
    #<strong>exec_ruby</strong>(args, **opts) {|controller| ... } &#x21d2; <tt><span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Toys::Utils::Exec::Controller</a></span></tt>, <tt><span class='object_link'><a href="Exec/Result.html" title="Toys::Utils::Exec::Result (class)">Toys::Utils::Exec::Result</a></span></tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='ruby-instance_method'>ruby</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Spawn a ruby process and pass the given arguments to it.</p>

<p>If the process is not set to run in the background, and a block is
provided, a <span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Controller</a></span> will be yielded to it.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>args</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The arguments to ruby.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>keywords</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The command options. See the section on
configuration options in the <span class='object_link'><a href="" title="Toys::Utils::Exec (class)">Toys::Utils::Exec</a></span> class docs.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>controller</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Toys::Utils::Exec::Controller</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A controller
for the subprocess streams.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Toys::Utils::Exec::Controller</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The subprocess controller, if
the process is running in the background.</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Exec/Result.html" title="Toys::Utils::Exec::Result (class)">Toys::Utils::Exec::Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The result, if the process ran in
the foreground.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


335
336
337
338
339
340</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/toys/utils/exec.rb', line 335</span>

<span class='kw'>def</span> <span class='id identifier rubyid_exec_ruby'>exec_ruby</span><span class='lparen'>(</span><span class='id identifier rubyid_args'>args</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> <span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='op'>::</span><span class='const'>Array</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='lbracket'>[</span><span class='op'>::</span><span class='const'>RbConfig</span><span class='period'>.</span><span class='id identifier rubyid_ruby'>ruby</span><span class='rbracket'>]</span> <span class='op'>+</span> <span class='id identifier rubyid_args'>args</span> <span class='op'>:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='op'>::</span><span class='const'>RbConfig</span><span class='period'>.</span><span class='id identifier rubyid_ruby'>ruby</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_args'>args</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_log_cmd'>log_cmd</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>exec ruby: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_args'>args</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='label'>argv0:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ruby</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>log_cmd:</span> <span class='id identifier rubyid_log_cmd'>log_cmd</span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_opts'>opts</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_exec'>exec</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sh-instance_method">
  
    #<strong>sh</strong>(cmd, **opts) {|controller| ... } &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Execute the given string in a shell. Returns the exit code.
Cannot be run in the background.</p>

<p>If a block is provided, a <span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Controller</a></span> will be
yielded to it.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>cmd</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The shell command to execute.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>opts</span>
      
      
        <span class='type'>(<tt>keywords</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The command options. See the section on
configuration options in the <span class='object_link'><a href="" title="Toys::Utils::Exec (class)">Toys::Utils::Exec</a></span> class docs.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>controller</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Exec/Controller.html" title="Toys::Utils::Exec::Controller (class)">Toys::Utils::Exec::Controller</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>A controller
for the subprocess streams.</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The exit code</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


448
449
450
451</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/toys/utils/exec.rb', line 448</span>

<span class='kw'>def</span> <span class='id identifier rubyid_sh'>sh</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_opts'>opts</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='label'>background:</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_exec'>exec</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='op'>**</span><span class='id identifier rubyid_opts'>opts</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_exit_code'>exit_code</span> <span class='op'>||</span> <span class='op'>-</span><span class='int'>1</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sun Nov 30 17:24:32 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.4.7).
</div>

    </div>
  </body>
</html>