<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: Toys::Mixin
  
    &mdash; Toys
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Toys::Mixin";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (M)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Toys.html" title="Toys (module)">Toys</a></span></span>
     &raquo; 
    <span class="title">Mixin</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: Toys::Mixin
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  
  <dl>
    <dt>Included in:</dt>
    <dd><span class='object_link'><a href="StandardMixins/Bundler.html" title="Toys::StandardMixins::Bundler (module)">StandardMixins::Bundler</a></span>, <span class='object_link'><a href="StandardMixins/Exec.html" title="Toys::StandardMixins::Exec (module)">StandardMixins::Exec</a></span>, <span class='object_link'><a href="StandardMixins/Fileutils.html" title="Toys::StandardMixins::Fileutils (module)">StandardMixins::Fileutils</a></span>, <span class='object_link'><a href="StandardMixins/Gems.html" title="Toys::StandardMixins::Gems (module)">StandardMixins::Gems</a></span>, <span class='object_link'><a href="StandardMixins/GitCache.html" title="Toys::StandardMixins::GitCache (module)">StandardMixins::GitCache</a></span>, <span class='object_link'><a href="StandardMixins/Highline.html" title="Toys::StandardMixins::Highline (module)">StandardMixins::Highline</a></span>, <span class='object_link'><a href="StandardMixins/Pager.html" title="Toys::StandardMixins::Pager (module)">StandardMixins::Pager</a></span>, <span class='object_link'><a href="StandardMixins/Terminal.html" title="Toys::StandardMixins::Terminal (module)">StandardMixins::Terminal</a></span>, <span class='object_link'><a href="StandardMixins/XDG.html" title="Toys::StandardMixins::XDG (module)">StandardMixins::XDG</a></span></dd>
  </dl>
  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/toys/mixin.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>A mixin definition. Mixin modules should include this module.</p>

<p>A mixin is a collection of methods that are available to be called from a
tool implementation (i.e. its run method). The mixin is added to the tool
class, so it has access to the same methods that can be called by the tool,
such as <span class='object_link'><a href="Context.html#get-instance_method" title="Toys::Context#get (method)">Context#get</a></span>.</p>

<h3 id="usage">Usage</h3>

<p>To create a mixin, define a module, and include this module. Then define
the methods you want to be available.</p>

<p>If you want to perform some initialization specific to the mixin, you can
provide an <em>initializer</em> block and/or an <em>inclusion</em> block. These can be
specified by calling the module methods defined in
<span class='object_link'><a href="Mixin/ModuleMethods.html" title="Toys::Mixin::ModuleMethods (module)">ModuleMethods</a></span>.</p>

<p>The initializer block is called when the tool context is instantiated
in preparation for execution. It has access to context methods such as
<span class='object_link'><a href="Context.html#get-instance_method" title="Toys::Context#get (method)">Context#get</a></span>, and can perform setup for the tool execution itself,
such as initializing some persistent state and storing it in the tool using
<span class='object_link'><a href="Context.html#set-instance_method" title="Toys::Context#set (method)">Context#set</a></span>. The initializer block is passed any extra arguments
that were provided to the <code>include</code> directive. Define the initializer by
calling <span class='object_link'><a href="Mixin/ModuleMethods.html#on_initialize-instance_method" title="Toys::Mixin::ModuleMethods#on_initialize (method)">ModuleMethods#on_initialize</a></span>.</p>

<p>The inclusion block is called in the context of your tool class when your
mixin is included. It is also passed any extra arguments that were provided
to the <code>include</code> directive. It can be used to issue directives to define
tools or other objects in the DSL, or even enhance the DSL by defining DSL
methods specific to the mixin. Define the inclusion block by calling
<span class='object_link'><a href="Mixin/ModuleMethods.html#on_include-instance_method" title="Toys::Mixin::ModuleMethods#on_include (method)">ModuleMethods#on_include</a></span>.</p>

<h3 id="example">Example</h3>

<p>This is an example that implements a simple counter. Whenever the counter
is incremented, a log message is emitted. The tool can also retrieve the
final counter value.</p>

<pre class="code ruby"><code class="ruby"><span class='comment'># Define a mixin by creating a module that includes Toys::Mixin
</span><span class='kw'>module</span> <span class='const'>MyCounterMixin</span>
  <span class='id identifier rubyid_include'>include</span> <span class='const'><span class='object_link'><a href="../Toys.html" title="Toys (module)">Toys</a></span></span><span class='op'>::</span><span class='const'>Mixin</span>

  <span class='comment'># Initialize the counter. Notice that the initializer is evaluated
</span>  <span class='comment'># in the context of the runtime context, so has access to the runtime
</span>  <span class='comment'># context state.
</span>  <span class='id identifier rubyid_on_initialize'>on_initialize</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_start'>start</span> <span class='op'>=</span> <span class='int'>0</span><span class='op'>|</span>
    <span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='symbol'>:counter_value</span><span class='comma'>,</span> <span class='id identifier rubyid_start'>start</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Mixin methods are evaluated in the runtime context and so have
</span>  <span class='comment'># access to the runtime context state, just as if you had defined
</span>  <span class='comment'># them in your tool.
</span>  <span class='kw'>def</span> <span class='id identifier rubyid_counter_value'>counter_value</span>
    <span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='symbol'>:counter_value</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_increment'>increment</span>
    <span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='symbol'>:counter_value</span><span class='comma'>,</span> <span class='id identifier rubyid_counter_value'>counter_value</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_logger'>logger</span><span class='period'>.</span><span class='id identifier rubyid_info'>info</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Incremented counter</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>

<p>Now we can use it from a tool:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_tool'>tool</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>count-up</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>do</span>
  <span class='comment'># Pass 1 as an extra argument to the mixin initializer
</span>  <span class='id identifier rubyid_include'>include</span> <span class='const'>MyCounterMixin</span><span class='comma'>,</span> <span class='int'>1</span>

  <span class='kw'>def</span> <span class='id identifier rubyid_run'>run</span>
    <span class='comment'># Mixin methods can be called.
</span>    <span class='int'>5</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_increment'>increment</span> <span class='rbrace'>}</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Final value is </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_counter_value'>counter_value</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
</code></pre>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
      <strong class="modules">Modules:</strong> <span class='object_link'><a href="Mixin/ModuleMethods.html" title="Toys::Mixin::ModuleMethods (module)">ModuleMethods</a></span>
    
  
    
  
</p>







  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create-class_method" title="create (class method)">.<strong>create</strong>(&amp;block)  &#x21d2; Class </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Create a mixin module with the given block.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="create-class_method">
  
    .<strong>create</strong>(&amp;block)  &#x21d2; <tt>Class</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Create a mixin module with the given block.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>block</span>
      
      
        <span class='type'>(<tt>Proc</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Defines the mixin module.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Class</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


87
88
89
90
91
92
93</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/toys/mixin.rb', line 87</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_create'>create</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_mixin_mod'>mixin_mod</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>Module</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>do</span>
    <span class='id identifier rubyid_include'>include</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../Toys.html" title="Toys (module)">Toys</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="Toys::Mixin (module)">Mixin</a></span></span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_mixin_mod'>mixin_mod</span><span class='period'>.</span><span class='id identifier rubyid_module_eval'>module_eval</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span>
  <span class='id identifier rubyid_mixin_mod'>mixin_mod</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Oct 17 06:01:30 2023 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.34 (ruby-3.2.2).
</div>

    </div>
  </body>
</html>