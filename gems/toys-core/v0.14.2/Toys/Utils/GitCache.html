<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Toys::Utils::GitCache
  
    &mdash; Toys
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Toys::Utils::GitCache";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (G)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Toys.html" title="Toys (module)">Toys</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Utils.html" title="Toys::Utils (module)">Utils</a></span></span>
     &raquo; 
    <span class="title">GitCache</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Toys::Utils::GitCache
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Toys::Utils::GitCache</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/toys/utils/git_cache.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>This object provides cached access to remote git data. Given a remote
repository, a path, and a commit, it makes the files availble in the
local filesystem. Access is cached, so repeated requests for the same
commit and path in the same repo do not hit the remote repository again.</p>

<p>This class is used by the Loader to load tools from git. Tools can also
use the <code>:git_cache</code> mixin for direct access to this class.</p>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="GitCache/Error.html" title="Toys::Utils::GitCache::Error (class)">Error</a></span>, <span class='object_link'><a href="GitCache/RefInfo.html" title="Toys::Utils::GitCache::RefInfo (class)">RefInfo</a></span>, <span class='object_link'><a href="GitCache/RepoInfo.html" title="Toys::Utils::GitCache::RepoInfo (class)">RepoInfo</a></span>, <span class='object_link'><a href="GitCache/SourceInfo.html" title="Toys::Utils::GitCache::SourceInfo (class)">SourceInfo</a></span>
    
  
</p>




  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#cache_dir-instance_method" title="#cache_dir (instance method)">#<strong>cache_dir</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>The cache directory.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get-instance_method" title="#get (instance method)">#<strong>get</strong>(remote, path: nil, commit: nil, into: nil, update: false, timestamp: nil)  &#x21d2; String </a>
    

    
      (also: #find)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Get the given git-based files from the git cache, loading from the remote repo if necessary.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(cache_dir: nil)  &#x21d2; GitCache </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Access a git cache.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remotes-instance_method" title="#remotes (instance method)">#<strong>remotes</strong>  &#x21d2; Array&lt;String&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns an array of the known remote names.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_refs-instance_method" title="#remove_refs (instance method)">#<strong>remove_refs</strong>(remote, refs: nil)  &#x21d2; Array&lt;RefInfo&gt;<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Remove records of the given refs (i.e. branches, tags, or <code>HEAD</code>) from the given repository&#39;s cache.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_repos-instance_method" title="#remove_repos (instance method)">#<strong>remove_repos</strong>(remotes)  &#x21d2; Array&lt;String&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Removes caches for the given repos, or all repos if specified.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#remove_sources-instance_method" title="#remove_sources (instance method)">#<strong>remove_sources</strong>(remote, commits: nil)  &#x21d2; Array&lt;SourceInfo&gt;<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Removes shared sources for the given cache.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#repo_info-instance_method" title="#repo_info (instance method)">#<strong>repo_info</strong>(remote)  &#x21d2; RepoInfo<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Returns a <span class='object_link'><a href="GitCache/RepoInfo.html" title="Toys::Utils::GitCache::RepoInfo (class)">RepoInfo</a></span> describing the cache for the given remote, or <code>nil</code> if the given remote has never been cached.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(cache_dir: nil)  &#x21d2; <tt><span class='object_link'><a href="" title="Toys::Utils::GitCache (class)">GitCache</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Access a git cache.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>cache_dir</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The path to the cache directory. Defaults to
a specific directory in the user&#39;s XDG cache.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


289
290
291
292</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/toys/utils/git_cache.rb', line 289</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='label'>cache_dir:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='ivar'>@cache_dir</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_expand_path'>expand_path</span><span class='lparen'>(</span><span class='id identifier rubyid_cache_dir'>cache_dir</span> <span class='op'>||</span> <span class='id identifier rubyid_default_cache_dir'>default_cache_dir</span><span class='rparen'>)</span>
  <span class='ivar'>@exec</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="../Utils.html" title="Toys::Utils (module)">Utils</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="Exec.html" title="Toys::Utils::Exec (class)">Exec</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="Exec.html#initialize-instance_method" title="Toys::Utils::Exec#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='label'>out:</span> <span class='symbol'>:capture</span><span class='comma'>,</span> <span class='label'>err:</span> <span class='symbol'>:capture</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="cache_dir-instance_method">
  
    #<strong>cache_dir</strong>  &#x21d2; <tt>String</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>The cache directory.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


299
300
301</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/toys/utils/git_cache.rb', line 299</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cache_dir'>cache_dir</span>
  <span class='ivar'>@cache_dir</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="get-instance_method">
  
    #<strong>get</strong>(remote, path: nil, commit: nil, into: nil, update: false, timestamp: nil)  &#x21d2; <tt>String</tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='find-instance_method'>find</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Get the given git-based files from the git cache, loading from the
remote repo if necessary.</p>

<p>The resulting files are either copied into a directory you provide in
the <code>:into</code> parameter, or populated into a <em>shared</em> source directory if
you omit the <code>:info</code> parameter. In the latter case, it is important
that you do not modify the returned files or directories, nor add or
remove any files from the directories returned, to avoid confusing
callers that could be given the same directory. If you need to make any
modifications to the returned files, use <code>:into</code> to provide your own
private directory.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>remote</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The URL of the git repo. Required.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>path</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The path to the file or directory within the repo.
Optional. Defaults to the entire repo.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>commit</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The commit reference, which may be a SHA or any
git ref such as a branch or tag. Optional. Defaults to <code>HEAD</code>.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>into</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>If provided, copies the specified files into the
given directory path. If omitted or <code>nil</code>, populates and returns a
shared source file or directory.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>update</span>
      
      
        <span class='type'>(<tt>Boolean</tt>, <tt>Integer</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>false</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Whether to update of non-SHA commit
references if they were previously loaded. This is useful, for
example, if the commit is <code>HEAD</code> or a branch name. Pass <code>true</code> or
<code>false</code> to specify whether to update, or an integer to update if
last update was done at least that many seconds ago. Default is
<code>false</code>.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The full path to the cached files. The returned path
will correspod to the path given. For example, if you provide the
path <code>Gemfile</code> representing a single file in the repository, the
returned path will point directly to the cached copy of that file.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


334
335
336
337
338
339
340
341
342
343
344
345
346
347
348</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/toys/utils/git_cache.rb', line 334</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='id identifier rubyid_remote'>remote</span><span class='comma'>,</span> <span class='label'>path:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>commit:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>into:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>update:</span> <span class='kw'>false</span><span class='comma'>,</span> <span class='label'>timestamp:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="" title="Toys::Utils::GitCache (class)">GitCache</a></span></span><span class='period'>.</span><span class='id identifier rubyid_normalize_path'>normalize_path</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_commit'>commit</span> <span class='op'>||=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>HEAD</span><span class='tstring_end'>&quot;</span></span>
  <span class='id identifier rubyid_timestamp'>timestamp</span> <span class='op'>||=</span> <span class='op'>::</span><span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='id identifier rubyid_dir'>dir</span> <span class='op'>=</span> <span class='id identifier rubyid_ensure_repo_base_dir'>ensure_repo_base_dir</span><span class='lparen'>(</span><span class='id identifier rubyid_remote'>remote</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_lock_repo'>lock_repo</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='id identifier rubyid_remote'>remote</span><span class='comma'>,</span> <span class='id identifier rubyid_timestamp'>timestamp</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_repo_lock'>repo_lock</span><span class='op'>|</span>
    <span class='id identifier rubyid_ensure_repo'>ensure_repo</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='id identifier rubyid_remote'>remote</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sha'>sha</span> <span class='op'>=</span> <span class='id identifier rubyid_ensure_commit'>ensure_commit</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='id identifier rubyid_commit'>commit</span><span class='comma'>,</span> <span class='id identifier rubyid_repo_lock'>repo_lock</span><span class='comma'>,</span> <span class='id identifier rubyid_update'>update</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_into'>into</span>
      <span class='id identifier rubyid_copy_files'>copy_files</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='id identifier rubyid_sha'>sha</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_repo_lock'>repo_lock</span><span class='comma'>,</span> <span class='id identifier rubyid_into'>into</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_ensure_source'>ensure_source</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='id identifier rubyid_sha'>sha</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_repo_lock'>repo_lock</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remotes-instance_method">
  
    #<strong>remotes</strong>  &#x21d2; <tt>Array&lt;String&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns an array of the known remote names.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


356
357
358
359
360
361
362
363
364
365
366
367
368</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/toys/utils/git_cache.rb', line 356</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remotes'>remotes</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_result'>result</span> <span class='kw'>unless</span> <span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span><span class='lparen'>(</span><span class='id identifier rubyid_cache_dir'>cache_dir</span><span class='rparen'>)</span>
  <span class='op'>::</span><span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_entries'>entries</span><span class='lparen'>(</span><span class='id identifier rubyid_cache_dir'>cache_dir</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_child'>child</span><span class='op'>|</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_child'>child</span><span class='period'>.</span><span class='id identifier rubyid_start_with?'>start_with?</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dir'>dir</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_cache_dir'>cache_dir</span><span class='comma'>,</span> <span class='id identifier rubyid_child'>child</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_file?'>file?</span><span class='lparen'>(</span><span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='const'>LOCK_FILE_NAME</span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_remote'>remote</span> <span class='op'>=</span> <span class='id identifier rubyid_lock_repo'>lock_repo</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='symbol'>:remote</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_result'>result</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_remote'>remote</span> <span class='kw'>if</span> <span class='id identifier rubyid_remote'>remote</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_refs-instance_method">
  
    #<strong>remove_refs</strong>(remote, refs: nil)  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="GitCache/RefInfo.html" title="Toys::Utils::GitCache::RefInfo (class)">RefInfo</a></span>&gt;</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Remove records of the given refs (i.e. branches, tags, or <code>HEAD</code>) from
the given repository&#39;s cache. The next time those refs are requested,
they will be pulled from the remote repo.</p>

<p>If you provide the <code>refs:</code> argument, only those refs are removed.
Otherwise, all refs are removed.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>remote</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The repository</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>refs</span>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>The refs to remove. Optional.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="GitCache/RefInfo.html" title="Toys::Utils::GitCache::RefInfo (class)">RefInfo</a></span>&gt;</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The refs actually forgotten, or <code>nil</code> if
the given repo is not in the cache.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


424
425
426
427
428
429
430
431
432
433
434
435
436</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/toys/utils/git_cache.rb', line 424</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove_refs'>remove_refs</span><span class='lparen'>(</span><span class='id identifier rubyid_remote'>remote</span><span class='comma'>,</span> <span class='label'>refs:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dir'>dir</span> <span class='op'>=</span> <span class='id identifier rubyid_repo_base_dir_for'>repo_base_dir_for</span><span class='lparen'>(</span><span class='id identifier rubyid_remote'>remote</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_lock_repo'>lock_repo</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='id identifier rubyid_remote'>remote</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_repo_lock'>repo_lock</span><span class='op'>|</span>
    <span class='id identifier rubyid_refs'>refs</span> <span class='op'>=</span> <span class='id identifier rubyid_repo_lock'>repo_lock</span><span class='period'>.</span><span class='id identifier rubyid_refs'>refs</span> <span class='kw'>if</span> <span class='id identifier rubyid_refs'>refs</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_refs'>refs</span> <span class='op'>==</span> <span class='symbol'>:all</span>
    <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_refs'>refs</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ref'>ref</span><span class='op'>|</span>
      <span class='id identifier rubyid_ref_data'>ref_data</span> <span class='op'>=</span> <span class='id identifier rubyid_repo_lock'>repo_lock</span><span class='period'>.</span><span class='id identifier rubyid_delete_ref!'>delete_ref!</span><span class='lparen'>(</span><span class='id identifier rubyid_ref'>ref</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_results'>results</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="GitCache/RefInfo.html" title="Toys::Utils::GitCache::RefInfo (class)">RefInfo</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_ref'>ref</span><span class='comma'>,</span> <span class='id identifier rubyid_ref_data'>ref_data</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_ref_data'>ref_data</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_repos-instance_method">
  
    #<strong>remove_repos</strong>(remotes)  &#x21d2; <tt>Array&lt;String&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Removes caches for the given repos, or all repos if specified.</p>

<p>Removes all cache information for the specified repositories, including
local clones and shared source directories. The next time these
repositories are requested, they will be reloaded from the remote
repository from scratch.</p>

<p>Be careful not to remove repos that are currently in use by other
GitCache clients.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>remotes</span>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>, <tt>:all</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The remotes to remove.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The remotes actually removed.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


399
400
401
402
403
404
405
406
407
408
409</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/toys/utils/git_cache.rb', line 399</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove_repos'>remove_repos</span><span class='lparen'>(</span><span class='id identifier rubyid_remotes'>remotes</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_remotes'>remotes</span> <span class='op'>=</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_remotes'>remotes</span> <span class='kw'>if</span> <span class='id identifier rubyid_remotes'>remotes</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_remotes'>remotes</span> <span class='op'>==</span> <span class='symbol'>:all</span>
  <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_remotes'>remotes</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_remote'>remote</span><span class='op'>|</span>
    <span class='id identifier rubyid_dir'>dir</span> <span class='op'>=</span> <span class='id identifier rubyid_repo_base_dir_for'>repo_base_dir_for</span><span class='lparen'>(</span><span class='id identifier rubyid_remote'>remote</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='rparen'>)</span>
      <span class='op'>::</span><span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_chmod_R'>chmod_R</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>u+w</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_dir'>dir</span><span class='rparen'>)</span>
      <span class='op'>::</span><span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_rm_rf'>rm_rf</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_remote'>remote</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="remove_sources-instance_method">
  
    #<strong>remove_sources</strong>(remote, commits: nil)  &#x21d2; <tt>Array&lt;<span class='object_link'><a href="GitCache/SourceInfo.html" title="Toys::Utils::GitCache::SourceInfo (class)">SourceInfo</a></span>&gt;</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Removes shared sources for the given cache. The next time a client
requests them, the removed sources will be recopied from the repo.</p>

<p>If you provide the <code>commits:</code> argument, only sources associated with
those commits are removed. Otherwise, all sources are removed.</p>

<p>Be careful not to remove sources that are currently in use by other
GitCache clients.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>remote</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The repository</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>commits</span>
      
      
        <span class='type'>(<tt>Array&lt;String&gt;</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>Remove only the sources for the given
commits. Optional.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Array&lt;<span class='object_link'><a href="GitCache/SourceInfo.html" title="Toys::Utils::GitCache::SourceInfo (class)">SourceInfo</a></span>&gt;</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>The sources actually removed, or <code>nil</code>
if the given repo is not in the cache.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/toys/utils/git_cache.rb', line 454</span>

<span class='kw'>def</span> <span class='id identifier rubyid_remove_sources'>remove_sources</span><span class='lparen'>(</span><span class='id identifier rubyid_remote'>remote</span><span class='comma'>,</span> <span class='label'>commits:</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dir'>dir</span> <span class='op'>=</span> <span class='id identifier rubyid_repo_base_dir_for'>repo_base_dir_for</span><span class='lparen'>(</span><span class='id identifier rubyid_remote'>remote</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_results'>results</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_lock_repo'>lock_repo</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='id identifier rubyid_remote'>remote</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_repo_lock'>repo_lock</span><span class='op'>|</span>
    <span class='id identifier rubyid_commits'>commits</span> <span class='op'>=</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_commits'>commits</span> <span class='op'>==</span> <span class='symbol'>:all</span>
    <span class='id identifier rubyid_shas'>shas</span> <span class='op'>=</span> <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_commits'>commits</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ref'>ref</span><span class='op'>|</span> <span class='id identifier rubyid_repo_lock'>repo_lock</span><span class='period'>.</span><span class='id identifier rubyid_lookup_ref'>lookup_ref</span><span class='lparen'>(</span><span class='id identifier rubyid_ref'>ref</span><span class='rparen'>)</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span> <span class='kw'>if</span> <span class='id identifier rubyid_commits'>commits</span>
    <span class='id identifier rubyid_repo_lock'>repo_lock</span><span class='period'>.</span><span class='id identifier rubyid_find_sources'>find_sources</span><span class='lparen'>(</span><span class='label'>shas:</span> <span class='id identifier rubyid_shas'>shas</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='lparen'>(</span><span class='id identifier rubyid_sha'>sha</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span><span class='op'>|</span>
      <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='id identifier rubyid_repo_lock'>repo_lock</span><span class='period'>.</span><span class='id identifier rubyid_delete_source!'>delete_source!</span><span class='lparen'>(</span><span class='id identifier rubyid_sha'>sha</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_results'>results</span> <span class='op'>&lt;&lt;</span> <span class='const'><span class='object_link'><a href="GitCache/SourceInfo.html" title="Toys::Utils::GitCache::SourceInfo (class)">SourceInfo</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='id identifier rubyid_sha'>sha</span><span class='comma'>,</span> <span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:sha</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_uniq'>uniq</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_sha'>sha</span><span class='op'>|</span>
      <span class='kw'>unless</span> <span class='id identifier rubyid_repo_lock'>repo_lock</span><span class='period'>.</span><span class='id identifier rubyid_source_exists?'>source_exists?</span><span class='lparen'>(</span><span class='id identifier rubyid_sha'>sha</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_sha_dir'>sha_dir</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='id identifier rubyid_sha'>sha</span><span class='rparen'>)</span>
        <span class='op'>::</span><span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_chmod_R'>chmod_R</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>u+w</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_sha_dir'>sha_dir</span><span class='comma'>,</span> <span class='label'>force:</span> <span class='kw'>true</span><span class='rparen'>)</span>
        <span class='op'>::</span><span class='const'>FileUtils</span><span class='period'>.</span><span class='id identifier rubyid_rm_rf'>rm_rf</span><span class='lparen'>(</span><span class='id identifier rubyid_sha_dir'>sha_dir</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_results'>results</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="repo_info-instance_method">
  
    #<strong>repo_info</strong>(remote)  &#x21d2; <tt><span class='object_link'><a href="GitCache/RepoInfo.html" title="Toys::Utils::GitCache::RepoInfo (class)">RepoInfo</a></span></tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a <span class='object_link'><a href="GitCache/RepoInfo.html" title="Toys::Utils::GitCache::RepoInfo (class)">RepoInfo</a></span> describing the cache for the given remote, or
<code>nil</code> if the given remote has never been cached.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>remote</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>Remote name for a repo</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="GitCache/RepoInfo.html" title="Toys::Utils::GitCache::RepoInfo (class)">RepoInfo</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


377
378
379
380
381
382
383</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/toys/utils/git_cache.rb', line 377</span>

<span class='kw'>def</span> <span class='id identifier rubyid_repo_info'>repo_info</span><span class='lparen'>(</span><span class='id identifier rubyid_remote'>remote</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_dir'>dir</span> <span class='op'>=</span> <span class='id identifier rubyid_repo_base_dir_for'>repo_base_dir_for</span><span class='lparen'>(</span><span class='id identifier rubyid_remote'>remote</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='op'>::</span><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_directory?'>directory?</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_lock_repo'>lock_repo</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='id identifier rubyid_remote'>remote</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_repo_lock'>repo_lock</span><span class='op'>|</span>
    <span class='const'><span class='object_link'><a href="GitCache/RepoInfo.html" title="Toys::Utils::GitCache::RepoInfo (class)">RepoInfo</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_dir'>dir</span><span class='comma'>,</span> <span class='id identifier rubyid_repo_lock'>repo_lock</span><span class='period'>.</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Sun Oct  9 21:48:22 2022 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.28 (ruby-2.7.6).
</div>

    </div>
  </body>
</html>