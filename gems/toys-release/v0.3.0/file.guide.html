<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: Toys-Release User Guide
  
    &mdash; Toys
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "guide";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="file_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: Toys-Release User Guide</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'><h1 id="toys-release-user-guide">Toys-Release User Guide</h1>

<p>Toys-Release is a release pipeline system built on GitHub Actions and the Toys
RubyGem. It interprets <a href="https://conventionalcommits.org/">conventional commit</a>
message format to automate changelog generation and updates library versions
based on semantic versioning. It supports fine tuning and approval of releases
using GitHub pull requests.</p>

<p>Out of the box, Toys-Release knows how to tag GitHub releases, build and push
RubyGems packages, and build and publish documentation to gh-pages. You can
customize the build pipeline and many aspects of its behavior.</p>

<p>This user&#39;s guide covers all the features of Toys-Release in detail, including
installation, normal operations, release pipeline customization, and a full
configuration reference.</p>

<p><strong>(This user&#39;s guide is still under construction.)</strong></p>

<h2 id="conceptual-overview">Conceptual overview</h2>

<p>Toys-Release is a comprehensive release pipeline system. It includes a set of
<strong>command line tools</strong> (built using the Toys framework) and a set of
<strong>GitHub actions</strong> that can be integrated into a GitHub repository to provide a
way to release new versions of packages present in that repository.</p>

<p>Toys-Release depends on the repository utilizing the <strong>conventional commits</strong>
standard (<a href="https://conventionalcommits.org">https://conventionalcommits.org</a>) to describe the changes made in each
commit to the repository. Using this information, it automatically generates
<strong>changelog</strong> entries and chooses a new package version to release, according
to the <strong>semantic versioning</strong> standard (<a href="https://semver.org/">https://semver.org/</a>).</p>

<p>Releases are requested explicitly by a repository maintainer by running a
command line tool or triggering a GitHub action. Toys-Release will configure
the release and open a <strong>release pull request</strong> describing the release. When
this pull request is merged, Toys-Release will automatically perform the
release. The pull request can also be modified to customize the release, or
closed without merging to cancel the release.</p>

<p>Toys-Release depends on a <strong>configuration file</strong> to describe which packages are
present in a repository and how to release them. It supports repositories
containing either a single package, or multiple packages (i.e. &quot;<strong>monorepos</strong>&quot;)
and can analyze a repository to identify changes applying to each package.</p>

<p>Toys-Release can build <strong>GitHub releases</strong>, publish <strong>RubyGems packages</strong>, and
build and publish documentation to <strong>GitHub pages</strong>.</p>

<p>Toys-Release uses the <a href="https://dazuma.github.io/toys/gems/toys/latest">Toys</a>
RubyGem, but does not require familiarity with Toys.</p>

<h2 id="installation">Installation</h2>

<p>Toys-Release must be installed into a GitHub repository. This involves:</p>

<ul>
<li>Installing a Toys tool;</li>
<li>Writing a configuration file;</li>
<li>Defining a set of GitHub Actions workflows and a set of GitHub labels
(a tool is provided to perform this step); and</li>
<li>Providing necessary credentials.</li>
</ul>

<h3 id="prerequisites">Prerequisites</h3>

<p>Toys-Release is written in Ruby, using the Toys framework. The installation
process requires these items to be installed locally, but normal operation
happens in GitHub Actions and does not require any local installation.</p>

<p>If you do not have Ruby or Toys installed locally, do so first. Install
Ruby 3.0 or later, and then install the Toys RubyGem using:</p>

<pre class="code sh"><code class="sh">gem install toys
</code></pre>

<p>Toys-Release requires Toys 0.18 or later. If you have an older version of Toys,
update it using:</p>

<pre class="code sh"><code class="sh">toys system update
</code></pre>

<p>Finally, you also need the GitHub command line tool, <code>gh</code>. Find installation
instructions at <a href="https://cli.github.com/">https://cli.github.com/</a>. If you are running on MacOS, for
example, the easiest way to install it is via homebrew:</p>

<pre class="code sh"><code class="sh">brew install gh
</code></pre>

<h3 id="install-the-release-tool">Install the release tool</h3>

<p>The Toys-Release tool needs to be installed in your repository, as a Toys tool
loaded from the <a href="https://rubygems.org/gems/toys-release">toys-release</a> gem.</p>

<p>Create <code>.toys/release.rb</code> (note the leading period in the directory name) in
your git repository. Use the following content:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_load_gem'>load_gem</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>toys-release</span><span class='tstring_end'>&quot;</span></span>
</code></pre>

<p>This will cause Toys-Release to use the latest version of Toys-Release. You can
also pin to a specific version of Toys-Release by specifying version
requirements similar to how those requirements are specified in RubyGems or
Bundler:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_load_gem'>load_gem</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>toys-release</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>~&gt; 0.3</span><span class='tstring_end'>&quot;</span></span>
</code></pre>

<p>Commit and push this change to your repository.</p>

<h3 id="write-the-configuration-file">Write the configuration file</h3>

<p>Next you will provide a configuration file for releases. This file is located
in your repository at <code>.toys/.data/releases.yml</code> (note the leading periods) and
lists all the releasable components (such as RubyGems packages) in your
repository, along with any customizations to the build/release process and
pipeline behavior.</p>

<p>To get you started, Toys-Release provides a config generation tool. Once the
release tool is installed as described above, you can run this from your local
repository clone directory:</p>

<pre class="code sh"><code class="sh">toys release gen-config
</code></pre>

<p>This will analyze your repository and generate an initial configuration file
for you. It will make a guess as to what releasable components/RubyGems are
present in your repository. At this stage, you do not need to get every
configuration exactly correct, but feel free to begin editing it if you so
choose. The remaining sections in this user&#39;s guide will cover the release
capabilities that you may need to configure in this file, and the
<a href="#configuration-reference">configuration reference</a> section below describes the
file format in detail.</p>

<h3 id="install-workflows-and-labels">Install workflows and labels</h3>

<p>Once an initial configuration file is present, you can finish the rest of the
installation by creating some needed labels in your GitHub repository and
installing some needed GitHub Actions workflows. These are done on the command
line using the release tool.</p>

<p>To create the GitHub repo labels, run this from your local repo clone directory:</p>

<pre class="code sh"><code class="sh">toys release create-labels
</code></pre>

<p>Then, to generate the GitHub Actions workflows, run:</p>

<pre class="code sh"><code class="sh">toys release gen-workflows
</code></pre>

<p>This will generate files in a <code>.github/workflows</code> directory in your repository.
Commit and push this change (along with the configuration file) to your
repository.</p>

<h3 id="provide-credentials">Provide credentials</h3>

<p>If Toys-Release will publish RubyGems packages, it will require credentials.
Provide those by creating a GitHub Actions Secret called <code>RUBYGEMS_API_KEY</code>.</p>

<p>In your GitHub repository web UI, go to the Settings tab, and choose
Secrets and Variables -&gt; Actions in the left nav. Create a repository secret
called <code>RUBYGEMS_API_KEY</code> whose value is an API key from RubyGems with
&quot;push rubygem&quot; scope. You can also provide this secret at the organization
level.</p>

<h2 id="release-operations">Release operations</h2>

<p>This section describes how Toys-Release manages releases and how you control
and interact with the process.</p>

<p>Overall, the process looks like this:</p>

<ol>
<li><p>A maintainer schedules a release by triggering the &quot;Open release request&quot;
GitHub Action. This action analyzes the repository, looking for changes in
each component, deciding which components have releasable updates,
determining the semver version bump for each, and building a changelog. It
then opens a pull request with the version and changelog updates.</p></li>
<li><p>The maintainer can either merge the pull request (possibly with manual
modifications to the changelogs and/or version numbers to release) or close
it unmerged.</p></li>
<li><p>If the pull request is merged, the release is automatically processed by
additional GitHub Actions. The automation verifies that the GitHub checks
pass, and runs the release pipeline.</p></li>
<li><p>The results of the run are reported back to the release pull request. If
the release failed, a GitHub issue is also automatically opened. A
maintainer can retry a failed release by triggering the &quot;Retry release&quot;
GitHub Action.</p></li>
</ol>

<h3 id="requesting-releases">Requesting releases</h3>

<p>To request a release, navigate to the Actions tab in the GitHub UI, select the
&quot;Open release request&quot; workflow, and click the &quot;Run workflow&quot; dropdown. This
will open a confirmation drop-down. Click the &quot;Run workflow&quot; button to confirm
and begin the automatic release analysis.</p>

<p>The dropdown provides an optional &quot;Components to release&quot; field. Often you can
leave this blank, and Toys-Release will analyze all components in the repository
and select the ones that have releasable changes pending. Alternatively, you
can choose which components to release by entering their names, space-delimited
in the field.</p>

<p>The field also supports setting the version number for each component, by
appending the version to the component name, separated by a colon.</p>

<p>For example, to request releases of the <code>toys</code> and <code>toys-release</code> components,
you can enter the following text into &quot;Components to release&quot;:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_toys'>toys</span> <span class='id identifier rubyid_toys'>toys</span><span class='op'>-</span><span class='id identifier rubyid_release'>release</span>
</code></pre>

<p>To make the above request but specifically request version 0.3.0 of the
<code>toys-release</code> component:</p>

<pre class="code ruby"><code class="ruby">toys toys-release:0.3.0
</code></pre>

<h3 id="managing-release-pull-requests">Managing release pull requests</h3>

<p>You can also specify which components get released and at which versions, by
modifying the release pull request. You can change the version in the pull
request, or even revert the version/changelog change for some components and/or
introduce version/changelog modifications for other components. The releases
that ultimately take place are simply dictated by what changes get introduced
by the commit introduced by merging the pull request.</p>

<p><strong>Important:</strong> If you modify a release pull request, be sure to <em>squash</em> your
changes when you merge it. It is important that the entire pull request is
expressed in a single commit, because the automation will look only at the
changes in the most recent commit after merge.</p>

<p>You will also notice that the pull request opened by the &quot;Open release request&quot;
workflow will have the <code>release: pending</code> label applied. This label signals the
release automation that this is a release pull request. If you remove this
label, the automation will not process the release.</p>

<p>Finally, you can even create a release pull request manually. You must simply
ensure that:</p>

<ul>
<li>The pull request has the <code>release: pending</code> label applied</li>
<li>The pull request merges as a single commit (i.e. &quot;squashed&quot;)</li>
<li>For each component you want to release, the version and changelog are
updated appropriately.</li>
</ul>

<p>If you close a release pull request without merging, the release will be
canceled. The automation will apply the <code>release: aborted</code> label to indicate
this.</p>

<h3 id="release-results-and-logs">Release results and logs</h3>

<p>(TODO)</p>

<h3 id="troubleshooting-and-retrying-releases">Troubleshooting and retrying releases</h3>

<p>(TODO)</p>

<h3 id="documentation-publication">Documentation publication</h3>

<p>(TODO)</p>

<h3 id="special-commit-tags">Special commit tags</h3>

<p>(TODO)</p>

<h3 id="running-on-the-command-line">Running on the command line</h3>

<p>(TODO)</p>

<h2 id="the-release-pipeline">The release pipeline</h2>

<p>Toys-Release features a highly configurable build pipeline. By default it is
configured to handle most RubyGems packages, and will:</p>

<ul>
<li>Tag and post a GitHub Release</li>
<li>Build a RubyGems package and push it to rubygems.org</li>
<li>Optionally build Yardoc documentation and push it to GitHub Pages</li>
</ul>

<p>The pipeline system, however, lets you customize any aspect of the process, and
even replace it with an entirely different process altogether, possibly even
handling a completely different type of releasable artifact. This section
covers the build pipeline. See also the
<a href="#build-step-configuration">build step configuration</a> section in the
configuration reference documentation.</p>

<h3 id="pipeline-steps">Pipeline steps</h3>

<p>(TODO)</p>

<h3 id="inter-step-communication-and-dependencies">Inter-step communication and dependencies</h3>

<p>(TODO)</p>

<h3 id="the-standard-pipeline">The standard pipeline</h3>

<p>(TODO)</p>

<h3 id="custom-steps">Custom steps</h3>

<p>(TODO)</p>

<h3 id="common-pipeline-modifications">Common pipeline modifications</h3>

<p>(TODO)</p>

<h2 id="configuration-reference">Configuration reference</h2>

<p>The Toys-Release configuration file is a <a href="https://yaml.org">YAML</a>-formatted
file located in your repository at <code>.toys/.data/releases.yml</code>. It controls all
aspects of the release process and behavior and is required.</p>

<p>This section will cover all keys in configuration file.</p>

<h3 id="top-level-configuration">Top level configuration</h3>

<p>The top level of the yaml file is a dictionary that can include the following
keys. Out of these, <strong>repo</strong>, <strong>git_user_name</strong>, and <strong>git_user_email</strong> are all
required. The rest are optional.</p>

<ul>
<li><p><strong>append_steps</strong>: <em>array of <a href="#build-step-configuration">BuildStepConfig</a></em> (optional) --
A list of build steps to append to the end of the default build pipeline.
This can be used to modify the default build pipeline instead of redefining
the entire pipeline using the <strong>steps</strong> key.</p></li>
<li><p><strong>breaking_change_header</strong>: <em>string</em> (optional) --
A changelog entry prefix that appears when a change is marked as breaking.
Default is <code>BREAKING CHANGE</code>.</p></li>
<li><p><strong>commit_tags</strong>: <em>array of <a href="#commit-tag-configuration">CommitTagConfig</a></em> (optional) --
A set of configurations defining how to interpret
<a href="https://conventionalcommits.org">conventional commit</a> tags, including how
they trigger releases, bump versions, and generate changelog entries. See
<a href="#commit-tag-configuration">commit tag configuration</a> for details.
If not included, Toys-Release will use a default configuration as follows:</p>

<ul>
<li>tag: feat
semver: minor
header: ADDED</li>
<li>tag: fix
semver: patch
header: FIXED</li>
<li>tag: docs
semver: patch</li>
</ul></li>
<li><p><strong>components</strong>: <em>array of <a href="#component-configuration">ComponentConfig</a></em> (optional) --
An array of releasable components, usually RubyGems packages. See
<a href="#component-configuration">Component Configuration</a> for details on the format
of each component. You can also use the name <strong>gems</strong> for this config key.</p></li>
<li><p><strong>coordinate_versions</strong>: <em>boolean</em> (optional) --
If set to true, this is a shorthand for setting up a coordination group
containing all components in this repository. Defaults to <em>false</em>.</p></li>
<li><p><strong>coordination_groups</strong>: <em>array of array of string</em> (optional) --
A list of disjoint sets of component names. Each set defines a group of
components that will always be released together with the same version
number. That is, if one or more components in a set are released, the entire
set is released, even components with no changes. This is useful for sets of
gems, such as the Rails gems, that are always released together.</p></li>
<li><p><strong>enable_release_automation</strong>: <em>boolean</em> (optional) --
When enabled, the release pipeline runs automatically when a release pull
request is merged. Defaults to <em>true</em>.</p></li>
<li><p><strong>gh_pages_enabled</strong>: <em>boolean</em> (optional) --
Whether to globally enable gh-pages publication for all releases. Defaults to
<em>false</em>.</p></li>
<li><p><strong>git_user_email</strong>: <em>string</em> (required) --
The git <code>user.email</code> setting to use when making git commits.</p></li>
<li><p><strong>git_user_name</strong>: <em>string</em> (required) --
The git <code>user.name</code> setting to use when making git commits.</p></li>
<li><p><strong>main_branch</strong>: <em>string</em> (optional) --
The name of the main branch. Defaults to <code>main</code> if not provided.</p></li>
<li><p><strong>modify_steps</strong>: <em>array of <a href="#build-step-modification">BuildStepModification</a></em> (optional) --
A set of modifications to the default build steps. This can be used to modify
the default build pipeline instead of redefining the entire pipeline using
the <strong>steps</strong> key.</p></li>
<li><p><strong>no_significant_updates_notice</strong>: <em>string</em> (optional) --
A notice that appears in a changelog when a release is done but no other
changelog entries are present. Default is <code>No significant updates.</code></p></li>
<li><p><strong>prepend_steps</strong>: <em>array of <a href="#build-step-configuration">BuildStepConfig</a></em> (optional) --
A list of build steps to prepend to the start of the default build pipeline.
This can be used to modify the default build pipeline instead of redefining
the entire pipeline using the <strong>steps</strong> key.</p></li>
<li><p><strong>release_branch_prefix</strong>: <em>string</em> (optional) --
The prefix for all release branch names. Defaults to <code>release</code>.</p></li>
<li><p><strong>release_aborted_label</strong>: <em>string</em> (optional) --
The name of the GitHub issue label that identifies aborted release pull
requests. Defaults to <code>release: aborted</code>.</p></li>
<li><p><strong>release_complete_label</strong>: <em>string</em> (optional) --
The name of the GitHub issue label that identifies successfully completed
release pull requests. Defaults to <code>release: complete</code>.</p></li>
<li><p><strong>release_error_label</strong>: <em>string</em> (optional) --
The name of the GitHub issue label that identifies release pull requests in
an error state. Defaults to <code>release: error</code>.</p></li>
<li><p><strong>release_pending_label</strong>: <em>string</em> (optional) --
The name of the GitHub issue label that identifies pending release pull
requests. Defaults to <code>release: pending</code>.</p></li>
<li><p><strong>repo</strong>: <em>string</em> (required) --
The GitHub repository name in the form <code>owner/repo</code>. For example, the Toys
repo is <code>dazuma/toys</code>.</p></li>
<li><p><strong>required_checks</strong>: <em>regexp/boolean</em> (optional) --
Identifies which GitHub checks must pass as a prerequisite for a release. If
a string is provided, it is interpreted as a Ruby regexp (PCRE) and
identifies the check names. A boolean value of <em>true</em> (the default) means all
checks must pass. A boolean value of <em>false</em> disables checking.</p></li>
<li><p><strong>required_checks_timeout</strong>: <em>integer</em> (optional) --
The time to wait, in seconds, for required checks to pass during release
processing. Defaults to 900 (i.e. 15 minutes).</p></li>
<li><p><strong>signoff_commits</strong>: <em>boolean</em> (optional) --
Whether to make commits with <code>--signoff</code>. Set this to true if your repository
has a policy that commits require signoff. Defaults to <em>false</em>.</p></li>
<li><p><strong>steps</strong>: <em>array of <a href="#build-step-configuration">BuildStepConfig</a></em> (optional) --
The build pipeline as a list of build steps. See
<a href="#build-step-configuration">build step configuration</a> for details on how to
define the pipeline. If this is not included, Toys-Release will use a default
pipeline as follows:</p>

<ul>
<li>name: bundle</li>
<li>name: build_gem</li>
<li>name: build_yard</li>
<li>name: release_github</li>
<li>name: release_gem
source: build_gem</li>
<li>name: push_gh_pages
source: build_yard</li>
</ul></li>
</ul>

<h3 id="commit-tag-configuration">Commit tag configuration</h3>

<p>A commit tag configuration specifies how the release system should handle a
particular <a href="https://conventionalcommits.org">conventional commits</a> tag,
including what kind of <a href="https://semver.org">semver</a> version bump it implies,
and how it should appear in the changelog. The format of the configuration is a
dictionary with the keys documented here. The <strong>tag</strong> key is required; the
remaining keys are optional and have defaults.</p>

<ul>
<li><p><strong>header</strong>: <em>string,null</em> (optional) --
A prefix that appears before each changelog entry generated by this tag. The
special value <em>null</em> suppresses changelog entry generation for this scope.
Defaults to the tag itself in all caps.</p></li>
<li><p><strong>scopes</strong>: <em>array of <a href="#scope-configuration">ScopeConfig</a></em> (optional) --
Overrides for conventional commit scopes.</p></li>
<li><p><strong>semver</strong>: <em>string</em> (optional) --
The semver version bump implied by changes of this type. Possible values are
<code>patch</code>, <code>minor</code>, <code>major</code>, and <code>none</code>. Default is <code>none</code>.</p></li>
<li><p><strong>tag</strong>: <em>string</em> (required) -- The conventional commit tag.</p></li>
</ul>

<h4 id="scope-configuration">Scope configuration</h4>

<p>A scope configuration provides override behavior for a particular scope name
in a commit tag configuration. This lets you provide special behavior for
individual scopes. A common case might be <code>chore(deps):</code> which is used by some
dependency-updating bots. Typically, <code>chore:</code> does not indicate a significant
change that should trigger a release or appear in a changelog, but you might
choose different behavior for dependency changes.</p>

<ul>
<li><p><strong>header</strong>: <em>string,null</em> (optional) --
A prefix that appears before each changelog entry generated by this tag. The
special value <em>null</em> suppresses changelog entry generation for this scope.
Defaults to the same setting used by the tag.</p></li>
<li><p><strong>scope</strong>: <em>string</em> (required) -- The scope name.</p></li>
<li><p><strong>semver</strong>: <em>string</em> (optional) -- 
The semver version bump implied by changes of this type. Possible values are
<code>patch</code>, <code>minor</code>, <code>major</code>, and <code>none</code>. Defaults to the same setting used by
the tag.</p></li>
</ul>

<h3 id="component-configuration">Component configuration</h3>

<p>A component configuration specifies how a particular component (often a
RubyGems package) should be released. Its format is a dictionary with the keys
documented here.</p>

<ul>
<li><p><strong>append_steps</strong>: <em>array of <a href="#build-step-configuration">BuildStepConfig</a></em> (optional) --
A list of build steps to append to the end of this component&#39;s build
pipeline. This can be used to modify the build pipeline instead of redefining
the entire pipeline using the <strong>steps</strong> key.</p></li>
<li><p><strong>changelog_path</strong>: <em>string</em> (optional) --
The path to the component&#39;s changelog file, relative to the component&#39;s
directory. Default is <code>CHANGELOG.md</code>.</p></li>
<li><p><strong>directory</strong>: <em>string</em> (optional) --
The directory within the repository where this component is located. Defaults
to the component name, unless there is exactly one component in this
repository, in which case the default is the root of the repository, i.e.
&quot;<code>.</code>&quot;. This directory is used to identify when files related to this
component have been changed, and is also used as a base directory for other
paths related to the component.</p></li>
<li><p><strong>exclude_globs</strong>: <em>array of string</em> (optional) --
An array of globs identifying files or directories that should be ignored
when identifying changes to this component. These paths are relative to the
repo root.</p></li>
<li><p><strong>gh_pages_directory</strong>: <em>string</em> (optional) --
The directory in the <code>gh-pages</code> branch under which this component&#39;s
documentation is published. The default is the component name.</p></li>
<li><p><strong>gh_pages_enabled</strong>: <em>boolean</em> (optional) --
Whether gh-pages documentation publishing is enabled for this component.
Default is <em>true</em> if either <strong>gh_pages_directory</strong> or <strong>gh_pages_version_var</strong>
is set explicitly; otherwise <em>false</em>.</p></li>
<li><p><strong>gh_pages_version_var</strong>: <em>string</em> (optional) --
The name of a Javascript variable within the <code>404.html</code> page under gh-pages
that identifies the latest release of this component. Defaults to a variable
name corresponding to the component name.</p></li>
<li><p><strong>include_globs</strong>: <em>array of string</em> (optional) --
An array of globs identifying additional files or directories, not located in
the component&#39;s directory itself, that should signal changes to this
component. This can be used, for example, if the repo has global files shared
by multiple components, where a change in such a file should trigger releases
for all those components. These paths are relative to the repo root.</p></li>
<li><p><strong>modify_steps</strong>: <em>array of <a href="#build-step-modification">BuildStepModification</a></em> (optional) --
A set of modifications to this component&#39;s build steps. This can be used to
modify the build pipeline instead of redefining the entire pipeline using
the <strong>steps</strong> key.</p></li>
<li><p><strong>name</strong>: <em>string</em> (required) --
The name of the component, e.g. the name of the RubyGems package if this
component represents a gem.</p></li>
<li><p><strong>prepend_steps</strong>: <em>array of <a href="#build-step-configuration">BuildStepConfig</a></em> (optional) --
A list of build steps to prepend to the start of this component&#39;s build
pipeline. This can be used to modify the build pipeline instead of redefining
the entire pipeline using the <strong>steps</strong> key.</p></li>
<li><p><strong>steps</strong>: <em>array of <a href="#build-step-configuration">BuildStepConfig</a></em> (optional) --
A way to override the complete build pipeline for this component. If not
present, the default pipeline for the entire repository is used. (See the
<strong>steps</strong> key under <a href="#top-level-configuration">Top level configuration</a>.)</p></li>
<li><p><strong>version_constant</strong>: <em>string</em> (optional) --
The fully-qualified name of the version constant. This is used to determine
the current version of the component. The default uses the module implied by
the component name. For example, if the component (gem) name is
<code>toys-release</code>, this defaults to <code>Toys::Release::VERSION</code>.</p></li>
<li><p><strong>version_rb_path</strong>: <em>string</em> (optional) --
The path to a Ruby file that contains the current version of the component.
This file <em>must</em> include Ruby code that looks like this:</p>

<p>VERSION = &quot;1.2.3&quot;</p></li>
</ul>

<p>where the string is the latest released version. (Prior to the initial
  release, this version should be <code>0.0.0</code>.) Typically, <code>VERSION</code> is a constant
  defined in the &quot;base module&quot; for the Ruby library.</p>

<p>The default is <code>version.rb</code> within the lib path associated with the Ruby
  module implied by the component name. For example, if the component (gem)
  name is <code>toys-release</code>, this defaults to <code>lib/toys/release/version.rb</code>.</p>

<h3 id="build-step-configuration">Build step configuration</h3>

<p>A build step describes one step in the release process. Its format is a
dictionary with the keys described below. Specific types of build steps may
define additional keys as documented under the section
<a href="#build-step-types">build step types</a>. For more introductory information, see
the section on <a href="#the-release-pipeline">the release pipeline</a> above.</p>

<ul>
<li><p><strong>name</strong>: <em>string</em> (optional) --
The unique name of this build step in the build pipeline. If not explicitly
provided, a unique name will be generated.</p></li>
<li><p><strong>type</strong>: <em>string</em> (optional) --
The type of build step, defining what it does. Possible values are:
<code>build_gem</code>, <code>build_yard</code>, <code>bundle</code>, <code>command</code>, <code>noop</code>, <code>push_gh_pages</code>,
<code>release_gem</code>, <code>release_github</code>, and <code>tool</code>. For more information, see the
section <a href="#build-step-types">build step types</a>.</p></li>
<li><p><strong>run</strong>: <em>boolean</em> (optional) --
Whether to force this step to run. Typically, build steps will run only if
the build type determines that it should run, or if the step is a dependency
of another step that will run. You can, however, force a step to run that
would otherwise not do so by setting this key to <em>true</em>.</p></li>
<li><p><strong>inputs</strong>: <em>array of <a href="#step-input-configuration">InputConfig</a></em> (optional) --
Inputs to this step, indicating dependencies on other steps and files to copy
from those steps&#39; outputs.</p></li>
<li><p><strong>outputs</strong>: <em>array of <a href="#step-output-configuration">OutputConfig</a></em> (optional) --
Files to copy to this step&#39;s output so they become available to other steps.</p></li>
</ul>

<h4 id="step-input-configuration">Step input configuration</h4>

<p>A step input represents a dependency on another step: if this step is run, the
other step will also be run. It also describes files that should be copied from
the dependent step&#39;s output and made available to the depending step. This
configuration is a dictionary supporting the following keys:</p>

<ul>
<li><p><strong>collisions</strong>: <em>string</em> (optional) --
A symbolic value indicating what to do if a collision occurs between incoming
and existing files. Possible values are:</p>

<ul>
<li><code>error</code>: (the default) Abort with an error</li>
<li><code>keep</code>: Keep the existing file</li>
<li><code>replace</code>: Replace the existing file with the incoming file</li>
</ul></li>
<li><p><strong>dest</strong>: <em>string or false</em> (optional) --
A symbolic value indicating where to copy the dependent step&#39;s output to.
Possible values are:</p>

<ul>
<li><code>component</code>: (the default) Copy files to the component directory</li>
<li><code>repo_root</code>: Copy files to the repository root</li>
<li><code>output</code>: Copy files to this step&#39;s output directory</li>
<li><code>temp</code>: Copy files to this step&#39;s temp directory</li>
<li><code>none</code>: Do not copy any files, but just declare a dependency</li>
</ul></li>
<li><p><strong>dest_path</strong>: <em>string</em> (optional) --
The path in the destination to copy to. If <strong>source_path</strong> is provided,
<strong>dest_path</strong> is the corresponding path in the destination. If <strong>source_path</strong>
is not provided, <strong>dest_path</strong> is a directory into which the source contents
are copied. If <strong>dest_path</strong> is not provided, it defaults to the effective
value of <strong>source_path</strong>, i.e. things are copied into the same locations
within the destination as they were in the source.</p></li>
<li><p><strong>name</strong>: <em>string</em> (required) --
The name of the step to depend on. The dependent step must be located earlier
in the pipeline than the depending step.</p></li>
<li><p><strong>source_path</strong>: <em>string</em> (optional) --
The path of the file or directory to copy from the source output. Only this
item (recursively, if a directory) is copied. If this key is not provided,
<em>all</em> contents of the source output are copied (e.g. the default is
effectively &quot;<code>.</code>&quot;)</p></li>
</ul>

<h4 id="step-output-configuration">Step output configuration</h4>

<p>A step output represents files automatically copied to the step&#39;s output
directory after the step runs. This configuration is a dictionary supporting
the following keys:</p>

<ul>
<li><p><strong>collisions</strong>: <em>string</em> (optional) --
A symbolic value indicating what to do if a collision occurs between incoming
and existing files. Possible values are:</p>

<ul>
<li><code>error</code>: (the default) Abort with an error</li>
<li><code>keep</code>: Keep the existing file</li>
<li><code>replace</code>: Replace the existing file with the incoming file</li>
</ul></li>
<li><p><strong>dest_path</strong>: <em>string</em> (optional) --
The path in the output directory to copy to. If <strong>source_path</strong> is provided,
<strong>dest_path</strong> is the corresponding path in the output. If <strong>source_path</strong> is
not provided, <strong>dest_path</strong> is a directory into which the source contents are
copied. If <strong>dest_path</strong> is not provided, it defaults to the effective value
of <strong>source_path</strong>, i.e. things are copied into the same locations within the
output as they were in the source.</p></li>
<li><p><strong>source</strong>: <em>string</em> (optional) --
A symbolic value indicating where to copy from. Possible values are:</p>

<ul>
<li><code>component</code>: (the default) Copy files from the component directory</li>
<li><code>repo_root</code>: Copy files from the repository root</li>
<li><code>temp</code>: Copy files from this step&#39;s temp directory</li>
</ul></li>
<li><p><strong>source_path</strong>: <em>string</em> (optional) --
The path of the file or directory to copy from the source. Only this item
(recursively, if a directory) is copied. If this key is not provided, <em>all</em>
contents of the source are copied (e.g. the default is effectively &quot;<code>.</code>&quot;)</p></li>
</ul>

<h4 id="build-step-types">Build step types</h4>

<p>This is a list of the available build step types, including their behavior and
any additional configuration keys supported by each.</p>

<ul>
<li><strong>build_gem</strong> -- A step that builds a gem package.</li>
</ul>

<p>This step builds the gem described by the properly named gemspec file for
  this component. The built package file is copied to this step&#39;s output. Other
  steps (such as <strong>release_gem</strong>) can declare it as an input to get access to
  the built package. This step does not run unless it is so declared as a
  dependency or unless it is requested explicitly.</p>

<ul>
<li><strong>build_yard</strong> -- A step that builds Yardocs.</li>
</ul>

<p>This step builds documentation using <a href="https://yardoc.org">YARD</a>. The built
  documentation is copied to this step&#39;s output in the directory <code>doc/</code>. Other
  steps (such as <strong>push_gh_pages</strong>) can declare it as an input to get access to
  the built documentation. This step does not run unless it is so declared as a
  dependency or unless it is requested explicitly.</p>

<p>This step supports the following additional configuration keys:</p>

<pre class="code ruby"><code class="ruby">* **bundle_step**: *string* (optional) --
  The name of the bundle step. Defaults to `bundle`. This is used if the
  **uses_gems** key is *not* provided.

* **uses_gems**: *array of (string or array of string)* (optional) --
  An array of gem specifications, each of which can be a simple gem name or
  an array including rubygems-style version requirements. These gems are
  provided to Yard, and can include gems such as `redcarpet` that may be
  needed for markup handling. If this key is included, the specified gems
  are installed directly; if not, the bundle step is declared as a
  dependency instead.
</code></pre>

<ul>
<li><strong>bundle</strong> -- A step that installs the bundle in the component directory.</li>
</ul>

<p>This step copies the resulting <code>Gemfile.lock</code> to its output. Other steps can
  declare it as an input to get access to the <code>Gemfile.lock</code>. This step
  does not run unless it is so declared as a dependency or unless it is
  requested explicitly.</p>

<p>This step supports the following additional configuration keys:</p>

<pre class="code ruby"><code class="ruby">* **chdir**: *string* (optional) --
  Change to the specified directory (relative to the component directory)
  when installing the bundle. By default, runs in the component directory.
</code></pre>

<ul>
<li><strong>command</strong> -- A step that runs a command in the component directory.</li>
</ul>

<p>This step supports the following additional configuration keys:</p>

<pre class="code ruby"><code class="ruby">* **chdir**: *string* (optional) --
  Change to the specified directory (relative to the component directory)
  when running the command. By default, runs in the component directory.

* **command**: *array of string* (required) --
  The command to run

* **continue_on_error**: *boolean* (optional) --
  If *true*, continue to run the pipeline if the command exits abnormally.
  If *false* (the default), the pipeline aborts.
</code></pre>

<p>This step does not run unless it is requested explicitly using the <strong>run</strong>
  configuration or it is declared as a dependency.</p>

<ul>
<li><strong>noop</strong> -- A no-op step that does nothing. This type is usually configured
with inputs and outputs and is used to collect or consolidate data from other
steps.</li>
</ul>

<p>This step does not run unless it is requested explicitly using the <strong>run</strong>
  configuration or it is declared as a dependency.</p>

<ul>
<li><strong>push_gh_pages</strong> -- A step that pushes documentation to the gh-pages branch.</li>
</ul>

<p>The documentation to publish should be under <code>doc/</code> in the output directory
  of a &quot;source&quot; step, normally the <strong>build_yard</strong> step. This source step is
  automatically declared as a dependency.</p>

<p>This step supports the following additional configuration keys:</p>

<pre class="code ruby"><code class="ruby">* **source**: *string* (optional) --
  The name of the source step. Defaults to `build_yard`.
</code></pre>

<p>This step runs if gh-pages publishing is enabled in the component.</p>

<ul>
<li><strong>release_gem</strong> -- A step that pushes a gem package to rubygems.org.</li>
</ul>

<p>The package must be provided under <code>pkg/</code> in the output directory of a
  &quot;source&quot; step, normally the <strong>build_gem</strong> step. This source step is
  automatically declared as a dependency.</p>

<p>This step supports the following additional configuration keys:</p>

<pre class="code ruby"><code class="ruby">* **source**: *string* (optional) --
  The name of the source step. Defaults to `build_gem`.
</code></pre>

<p>This step runs if a correctly-named gemspec file is present in the component
  directory.</p>

<ul>
<li><strong>release_github</strong> -- A step that creates a git tag and GitHub release.</li>
</ul>

<p>This step always runs if present in the pipeline.</p>

<ul>
<li><strong>tool</strong> -- A step that runs a Toys tool in the component directory.</li>
</ul>

<p>This step supports the following additional configuration keys:</p>

<pre class="code ruby"><code class="ruby">* **chdir**: *string* (optional) --
  Change to the specified directory (relative to the component directory)
  when running the tool. By default, runs in the component directory.

* **continue_on_error**: *boolean* (optional) --
  If *true*, continue to run the pipeline if the tool exits abnormally. If
  *false* (the default), the pipeline aborts.

* **tool**: *array of string* (required) --
  The tool to run
</code></pre>

<p>This step does not run unless it is requested explicitly using the <strong>run</strong>
  configuration or it is declared as a dependency.</p>

<h4 id="build-step-modification">Build step modification</h4>

<p>A build step modification is a dictionary that modifies one or more existing
steps in the build pipeline. Its format is a dictionary with the keys described
below.</p>

<p>The <strong>name</strong> and <strong>type</strong> fields filter the steps to modify. If neither is
provided, <em>all</em> steps are modified.</p>

<ul>
<li><p><strong>name</strong>: <em>string</em> (optional) --
Modify only the step with this unique name.</p></li>
<li><p><strong>type</strong>: <em>string</em> (optional) --
Modify only steps matching this type.</p></li>
</ul>

<p>All other keys represent changes to the configuration of matching steps. You
can provide either the <em>null</em> value to delete the key, or a new full value for
the key. See <a href="#build-step-configuration">build step configuration</a> and
<a href="#build-step-types">build step types</a> for details on the available keys and
their formats.</p>
</div></div>

      <div id="footer">
  Generated on Sat Dec  6 04:45:03 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-3.4.7).
</div>

    </div>
  </body>
</html>